---
title: "【Unity】muscleを使用した指制御入門"
emoji: "💪"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["unity", "humanoid", "指制御", "muscle"]
published: false
---

# はじめに

どうも[にー兄さん(@ninisan_drumath)](https://twitter.com/ninisan_drumath)と申します。
Zenn 初投稿です。

## TL;DR

Unity で人型モデルの指制御をするには muscle がよさそう。

## この記事を読んで得られる知見・対象読者

この記事を読んで得られる知見は以下の通りです。

- 外部パッケージを使わない指制御の方法の一例
- Unity で人型モデルをどう扱うか
- muscle という概念
- 指制御は沼なんじゃないかという疑念・焦り・諦め・お気持ち

対象読者は以下のとおりです。

- Unity の基本知識がある
- Unity でアバターを制御したい
- Unity で指制御をしてみたい

## この記事で扱わない事項

この記事では、以下のような内容は細かく扱いません。

- VTuber システムをどう作るのか
- センサリングを用いた開発の仕方
- 全身の制御の仕方

## 検証環境

この記事は以下のような環境で検証されています。
ご参考になさってください。

|環境|概要|
|:--:|:--:|
|OS|Windows10 Home|
|CPU|Intel Core-i7 7700|
|GPU|GTX Geforce 1060|
|Unity|2019.4.12|

# Humanoid制御とmuscle

まず、Unity でどのように人型のモデル(アバター)を制御するのかについて簡単に説明します。

## UnityのHumanoidシステムについて

:::message
基本的な項目になりますので、
「もう知っているよ」という方は読み飛ばしていただいて構いません。
:::

**「世の中には 2 種類のリグしかない。人型か、それ以外か」**
(出典：古事記)

Unity では`General`と`Humanoid`というリグがあります。
これらは字のごとく人間(Humanoid) か一般的なリグかという意味で、Humanoid の場合は特別に別の Humanoid のアニメーションを流用できたり、体の特定のボーンをスクリプトから制御しやすくなっていたりするのです。
そのため、Humanoid の定義を満たすためには人間を構成するのに必須なボーンがちゃんと指定してある必要があり、それは Unity の GUI またはスクリプトから設定が可能です。

先ほど Humanoid のモデルは特定のボーンを制御しやすいということを書きました。
Humanoid のモデルは Animator コンポーネントがアタッチされており、そのコンポーネント経由でアバターのポーズ制御が可能なのです。例えば以下のコードを書くことで任意の Humanoid モデルの腕を曲げることができます。

```cs : HumanoidTest.cs
using Unity.Engine;

[ReqiredComponent(typeof(Animator))]
public class HumanoidTest: MonoBehaviour
{
  Animator _animator;

  private void Start()
  {
    _animtor = GetComponent<Animator>();

    _animator.GetHumanBoneTransform(HumanBones.LeftUpperArm)
    .rotation(
      Quaternion.identity 
      * Quaternion.AngleAxis(60, new Vector3(1,0,0))
    );
  }
}
```

上のコードではボーンの Transofmr を直接操作して変えているため、もし肘や手首も曲げることになった時には肘と手首のボーンを同じように回転させてやる必要があります。このように、親のボーンから個のボーンにかけてポーズを決めていくような制御の方法を FK と言います。
逆に、末端のボーンの Transform がを先に決め、そのボーンに合わせて親のボーンの Transform を毛呈するような制御の方法を IK と言い、多少書き方が変わりますが Unity では IK もサポートしています。

## muscleシステムとは

# 指のmuscle

## 指のmuscle値について

## streched、spreadによる制御

## 指の角度による制御

# おわりに
