---
title: "HDRPでもトゥーンシェーダを使いたい！"
emoji: "👀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["unity", "HDRP", "トゥーンシェーダ", "shader", "アドベントカレンダー2020"]
published: false
---

こちらの記事は[Unity HDRPアドベントカレンダー](https://qiita.com/advent-calendar/2020/unity-hdrp-advent-calender)及び[愚者っとCorp.アドベントカレンダー](https://adventar.org/calendars/5126)9 日目の記事です。

# はじめに

にー兄さんと申します。
自分は Unity をよく使っていて、Unity の中でキャラクターモデルのルック調整をすることがあるのですが、
それを HDRP でもやってみたいと思い今回記事を執筆しました。

## TL;DR

RealToon を使えば HDRP のプロジェクトでトゥーンシェーダを使えるらしい。

## 想定読者

- Unity HDRP を使ったことがある
- トゥーンシェーダというものを知っている
- キャラルックとかに興味がある

## 検証環境

検証環境は以下の通りです。

||環境|
|:---:|:---:|
|OS|Windows 10 Home|
|Unity|2019.4.16|
|HDRP|7.3.1|
|UniVRM|0.59|
|RealToon|5.0.7|

# HDRPでトゥーンシェーダを使う

ここからは HDRP でトゥーンシェーダを使う手順を簡単に説明します。

## RealToonについて

TL;DR にも書いた通り、今回は RealToon というアセットを使うことにより
トゥーンシェーディングを実現します。

![realtoon](https://storage.googleapis.com/zenn-user-upload/0vfyyo1ctb0rdrzmlqesiemxhakf)

RealToon を導入するには、アセットストアの[こちらのページ](https://assetstore.unity.com/packages/vfx/shaders/realtoon-65518?locale=ja-JP)からで購入する必要があります。
この記事が公開される時点では$26 ですね。日本円で 3000 円しないくらいって感じでしょうか。
実は有名なアセットだからなのか、セールなどで頻繁に安くなるためその時に買うことをお勧めします。
自分も 50％オフくらいで買った気がします。

RealToon は Unity でトゥーンシェーダを扱うためのアセットで、自分が確認したなかではアセットストアで公開されているシェーダ系アセットのなかで唯一 HDRP に対応していました。
URP 対応は結構いろんなシェーダで見かけるのですが、HDRP は難しそうですね。Github を漁るといくつか出てきます。

これは余談ですが、Twitter で RealToonﾜｶﾗﾝ～ってツイートをすると、たとえ日本語でも RealToon の公式から「どしたん? Need help?」ってサポート DM が飛んできます。エゴサ力最高。

## Unity HDRPにRealToonを導入する

まずは Unity で HDRP プロジェクトを作成します。ここでは特にこだわりなく、テンプレートから作成しちゃって大丈夫です。
その次に RealToon の Unity パッケージをインポートします。Unity2019 をお使いでしたら Package Manager からアセットストアで購入したアセットをインポートするのが簡単です。

Assets 以下に RealToon というフォルダが生成されていれば無事インポートができている状態なのですが、
実はこのままだと HDRP のシェーダがインポートされていません。
そこで`Assets/RealToon/SRP/HDRP/`の中にある unitypackage ファイルを選択して、HDRP 用のシェーダをインポートします。

これで HDRP で RealToon シェーダを使うことができるようになりました。

## VRoidモデルをRealToonでセットアップしてみる

それでは RealToon でキャラクターモデルをセットアップしてみましょう。
他のモデルでも構いませんが、今回は VRoid Studio 公式モデルの[千駄ヶ谷篠](https://hub.vroid.com/characters/5860098757548846785/models/6567311261748429976)さんを使わせていただきます。

.vrm 形式のモデルになりますので、別途 UniVRM[^1] をインポートしてモデルを読み込みます。
UniVRM で読み込んだモデルはデフォルトで MToon シェーダが適用されていますが、MToon は HDRP 対応していないためモデルが心臓に悪いマジェンタ色で染まってしまいました。
[^1]:VRMのUnity実装。https://github.com/vrm-c/UniVRM

vrm モデルのマテリアルは`[モデルの名前].Materials`というフォルダに入っているので、そこのマテリアルを MToon から HDRP 対応のシェーダへ変更していきます。
全部のマテリアルを RealToon にしてもいいのですが、実際目とかアイラインとかは別に凝ったシェーディングをしなくてもいいかな派なので、
そのような個所は HDRP/Unlit を使っていきます。今回 RealToon にするのは肌とか服とか髪がメインですね。

まずはマテリアルを MToon から HDRP 対応シェーダに変更してみましょう。
以下の表のようにシェーダを適用します。

|シェーダ|マテリアル名|
|:--:|:--:|
|HDRP/Unlit||
|HDRP/RealToon/Version5||

シェーダを変更するところまでだとこんな感じに。う～ん調整が必要です。
RealToon シェーダですが、メインテクスチャは設定しなくても MToon のものが引き継がれるようになっていてシェーダ変更のときに便利でいいですね。

### RealToon/Version5シェーダのインスペクタを臨む

RealToon シェーダの設定項目を見てみましょう。
Face_SKIN マテリアルを MToon から RealToon に変更した時点ではこのようになっています。

デフォルト設定だと、メインテクスチャと陰影の設定がありますね。

## そもそもHDRPでトゥーンってどうなのか

実際ニーズとしてはかなり少ないのではないかと自分は思っていて、というのも HDRP がフォトリアルなシーンを構築する際に使われることが多いからです。
もし(VFX Graph や Shader Graph を使いたいなどの要望のため)SRP 環境を使いたくて、NPR シェーダを扱う必要があるのなら URP を使えばいいというのもあります。
あと自分はあまりよくわかっていないのですが、HDRP でトゥーンシェーダを作るのは比較的難易度が高いという話も聞いたことがあります。
そして、もし HDRP で NPR を扱えたとしても、背景だったり、周囲の環境にマッチしない可能性もあります。

以上から、HDRP におけるトゥーンシェーダの利用はあまり需要が高いとは言えなさそうです。
しかし、たとえば GPU リソースを有効に活用して豪華な演出をしながら、その中でアニメ長のキャラクターを動かしたいとなると、HDRP を使える可能性があります。
特に最近は Unity を使った映像制作の事例も出てきたので、"The Fantom Knowledge"の HDRP 版みたいなものも出てきたりしたらアツいですね。

# おわりに

10 日目の担当は Rito 君で「音声作品超入門」です。